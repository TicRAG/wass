<mxfile host="app.diagrams.net" modified="2023-10-27T10:00:00.000Z" agent="DrawIO-Designer" version="21.1.2">
  <diagram name="Decoupled_Dual_GNN_WASS_RAG" id="WASS-RAG-Architecture">
    <mxGraphModel dx="1100" dy="700" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <mxCell id="node_input" value="&lt;b&gt;System State&lt;/b&gt;&lt;br&gt;s&lt;sub&gt;t&lt;/sub&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;strokeWidth=2;fontFamily=Helvetica;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="40" y="220" width="100" height="60" as="geometry" />
        </mxCell>

        <mxCell id="lbl_policy" value="&lt;b&gt;Policy Branch (Trainable)&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontColor=#0066CC;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="200" y="80" width="160" height="20" as="geometry" />
        </mxCell>

        <mxCell id="node_pol_enc" value="Policy Encoder&lt;br&gt;GNN (ϕ&lt;sub&gt;pol&lt;/sub&gt;)&lt;br&gt;&lt;i&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;Gradient Flow&lt;/font&gt;&lt;/i&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;fontFamily=Helvetica;" vertex="1" parent="1">
          <mxGeometry x="220" y="120" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="node_pol_emb" value="Embedding&lt;br&gt;e&lt;sub&gt;pol&lt;/sub&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;arcSize=50;" vertex="1" parent="1">
          <mxGeometry x="390" y="130" width="80" height="40" as="geometry" />
        </mxCell>

        <mxCell id="node_ac" value="Actor-Critic&lt;br&gt;Network" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="520" y="120" width="100" height="60" as="geometry" />
        </mxCell>

        <mxCell id="node_action" value="Action&lt;br&gt;a&lt;sub&gt;t&lt;/sub&gt;" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;strokeWidth=2;fontWeight=bold;" vertex="1" parent="1">
          <mxGeometry x="680" y="125" width="60" height="50" as="geometry" />
        </mxCell>

        <mxCell id="lbl_retrieval" value="&lt;b&gt;Retrieval Branch (Frozen)&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontColor=#666666;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="200" y="280" width="160" height="20" as="geometry" />
        </mxCell>

        <mxCell id="node_ret_enc" value="Retrieval Encoder&lt;br&gt;GNN (ϕ&lt;sub&gt;ret&lt;/sub&gt;)&lt;br&gt;&lt;i&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;Fixed Params&lt;/font&gt;&lt;/i&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;strokeWidth=1;fontColor=#333333;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="220" y="320" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="node_query" value="Query Key&lt;br&gt;q&lt;sub&gt;t&lt;/sub&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;arcSize=50;" vertex="1" parent="1">
          <mxGeometry x="390" y="330" width="80" height="40" as="geometry" />
        </mxCell>

        <mxCell id="node_kb" value="Knowledge Base&lt;br&gt;&lt;i&gt;FAISS Index&lt;/i&gt;" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="385" y="420" width="90" height="60" as="geometry" />
        </mxCell>

        <mxCell id="node_neighbors" value="Neighbors&lt;br&gt;{k&lt;sub&gt;j&lt;/sub&gt;, v&lt;sub&gt;j&lt;/sub&gt;}" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="520" y="380" width="100" height="40" as="geometry" />
        </mxCell>

        <mxCell id="node_potential" value="Potential Func&lt;br&gt;Φ(s)" style="triangle;whiteSpace=wrap;html=1;direction=west;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="540" y="320" width="60" height="50" as="geometry" />
        </mxCell>

        <mxCell id="node_pbrs" value="PBRS /&lt;br&gt;Reward Shaping" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="660" y="300" width="110" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="node_raw_reward" value="Raw Reward&lt;br&gt;r&lt;sub&gt;t&lt;/sub&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
           <mxGeometry x="685" y="400" width="60" height="30" as="geometry" />
        </mxCell>

        <mxCell id="node_shaped_reward" value="Shaped Reward r't" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontWeight=bold;" vertex="1" parent="1">
           <mxGeometry x="780" y="320" width="100" height="30" as="geometry" />
        </mxCell>

        <mxCell id="edge_in_up" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="node_input" target="node_pol_enc">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge_in_low" value="|| Stop Gradient" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#FF3333;" edge="1" parent="1" source="node_input" target="node_ret_enc">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="edge_up_1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="node_pol_enc" target="node_pol_emb">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge_up_2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="node_pol_emb" target="node_ac">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge_up_3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="node_ac" target="node_action">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge_low_1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="node_ret_enc" target="node_query">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="edge_rag_1" value="Top-k Search" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="node_query" target="node_kb">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge_rag_2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="node_kb" target="node_neighbors">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="480" y="450" />
              <mxPoint x="480" y="400" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="edge_rag_3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="node_query" target="node_potential">
          <mxGeometry relative="1" as="geometry">
             <Array as="points">
              <mxPoint x="480" y="350" />
              <mxPoint x="480" y="345" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="edge_pot_pbrs" value="Potential&lt;br&gt;Diff" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="node_potential" target="node_pbrs">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="edge_raw" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="node_raw_reward" target="node_pbrs">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge_feedback" value="&lt;b&gt;PPO Update&lt;/b&gt;" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#FF8000;" edge="1" parent="1" source="node_pbrs" target="node_pol_enc">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="800" y="335" />
              <mxPoint x="800" y="40" />
              <mxPoint x="280" y="40" />
            </Array>
          </mxGeometry>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
